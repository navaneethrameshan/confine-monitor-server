<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Info timeline</title>
<center><h1><a href="http://{{server_ip }}:{{server_port }}">Confine Research Device Status</a></h1></center>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript">

$(function () {

    Highcharts.theme = {
        colors: ["#DDDF0D", "#7798BF", "#55BF3B", "#DF5353", "#aaeeee", "#ff0066", "#eeaaee",
            "#55BF3B", "#DF5353", "#7798BF", "#aaeeee"],
        chart: {
            backgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0, 'rgb(96, 96, 96)'],
                    [1, 'rgb(16, 16, 16)']
                ]
            },
            borderWidth: 0,
            borderRadius: 15,
            plotBackgroundColor: null,
            plotShadow: false,
            plotBorderWidth: 0
        },
        title: {
            style: {
                color: '#FFF',
                font: '16px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
            }
        },
        subtitle: {
            style: {
                color: '#DDD',
                font: '12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
            }
        },
        xAxis: {
            gridLineWidth: 0,
            lineColor: '#999',
            tickColor: '#999',
            labels: {
                style: {
                    color: '#999',
                    fontWeight: 'bold'
                }
            },
            title: {
                style: {
                    color: '#AAA',
                    font: 'bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
                }
            }
        },
        yAxis: {
            alternateGridColor: null,
            minorTickInterval: null,
            gridLineColor: 'rgba(255, 255, 255, .1)',
            minorGridLineColor: 'rgba(255,255,255,0.07)',
            lineWidth: 0,
            tickWidth: 0,
            labels: {
                style: {
                    color: '#999',
                    fontWeight: 'bold'
                }
            },
            title: {
                style: {
                    color: '#AAA',
                    font: 'bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
                }
            }
        },
        legend: {
            itemStyle: {
                color: '#CCC'
            },
            itemHoverStyle: {
                color: '#FFF'
            },
            itemHiddenStyle: {
                color: '#333'
            }
        },
        labels: {
            style: {
                color: '#CCC'
            }
        },
        tooltip: {
            backgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0, 'rgba(96, 96, 96, .8)'],
                    [1, 'rgba(16, 16, 16, .8)']
                ]
            },
            borderWidth: 0,
            style: {
                color: '#FFF'
            }
        },


        plotOptions: {
            series: {
                shadow: true
            },
            line: {
                dataLabels: {
                    color: '#CCC'
                },
                marker: {
                    lineColor: '#333'
                }
            },
            spline: {
                marker: {
                    lineColor: '#333'
                }
            },
            scatter: {
                marker: {
                    lineColor: '#333'
                }
            },
            candlestick: {
                lineColor: 'white'
            }
        },

        toolbar: {
            itemStyle: {
                color: '#CCC'
            }
        },

        navigation: {
            buttonOptions: {
                symbolStroke: '#DDDDDD',
                hoverSymbolStroke: '#FFFFFF',
                theme: {
                    fill: {
                        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                        stops: [
                            [0.4, '#606060'],
                            [0.6, '#333333']
                        ]
                    },
                    stroke: '#000000'
                }
            }
        },

        // scroll charts
        rangeSelector: {
            buttonTheme: {
                fill: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                    stops: [
                        [0.4, '#888'],
                        [0.6, '#555']
                    ]
                },
                stroke: '#000000',
                style: {
                    color: '#CCC',
                    fontWeight: 'bold'
                },
                states: {
                    hover: {
                        fill: {
                            linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                            stops: [
                                [0.4, '#BBB'],
                                [0.6, '#888']
                            ]
                        },
                        stroke: '#000000',
                        style: {
                            color: 'white'
                        }
                    },
                    select: {
                        fill: {
                            linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                            stops: [
                                [0.1, '#000'],
                                [0.3, '#333']
                            ]
                        },
                        stroke: '#000000',
                        style: {
                            color: 'yellow'
                        }
                    }
                }
            },
            inputStyle: {
                backgroundColor: '#333',
                color: 'silver'
            },
            labelStyle: {
                color: 'silver'
            }
        },

        navigator: {
            handles: {
                backgroundColor: '#666',
                borderColor: '#AAA'
            },
            outlineColor: '#CCC',
            maskFill: 'rgba(16, 16, 16, 0.5)',
            series: {
                color: '#7798BF',
                lineColor: '#A6C7ED'
            }
        },

        scrollbar: {
            barBackgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0.4, '#888'],
                    [0.6, '#555']
                ]
            },
            barBorderColor: '#CCC',
            buttonArrowColor: '#CCC',
            buttonBackgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0.4, '#888'],
                    [0.6, '#555']
                ]
            },
            buttonBorderColor: '#CCC',
            rifleColor: '#FFF',
            trackBackgroundColor: {
                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                stops: [
                    [0, '#000'],
                    [1, '#333']
                ]
            },
            trackBorderColor: '#666'
        },

        // special colors for some of the demo examples
        legendBackgroundColor: 'rgba(48, 48, 48, 0.8)',
        legendBackgroundColorSolid: 'rgb(70, 70, 70)',
        dataLabelsColor: '#444',
        textColor: '#E0E0E0',
        maskColor: 'rgba(255,255,255,0.3)'
    };

// Apply the theme
    var highchartsOptions = Highcharts.setOptions(Highcharts.theme);
    {% comment %}var data = [
        [1321468980000, 98],
        [1321123380000, 100],
        [1321825380000, 100],
        [1321332180000, 91],
        [1322196180000, 97],
        [1321144980000, 93],
        [1321447380000, 94],
        [1321850580000, 94],
        [1321922580000, 99],
        [1320864180000, 94],
        [1321479780000, 96],
        [1320745500000, 94],
        [1322239380000, 89],
        [1322484180000, 96],
        [1320770580000, 99],
        [1320727380000, 83],
        [1321576980000, 97],
        [1320788580000, 98],
        [1321317780000, 95],
        [1321792980000, 93],
        [1321245780000, 90],
        [1321936980000, 94],
        [1322419380000, 98],
        [1322246580000, 92],
        [1321900980000, 89],
        [1322570580000, 93],
        [1320831780000, 100],
        [1321750200000, 97],
        [1321350180000, 97],
        [1321652580000, 99],
        [1322592180000, 95],
        [1321738980000, 98],
        [1321177380000, 94],
        [1321134180000, 95],
        [1322268180000, 90],
        [1322368980000, 98],
        [1320842580000, 93],
        [1320756240000, 96],
        [1322300580000, 95],
        [1320885780000, 70],
        [1321620180000, 94],
        [1321231380000, 97],
        [1321461780000, 98],
        [1322282580000, 95],
        [1321393380000, 98],
        [1321728240000, 97],
        [1322584980000, 88],
        [1321721040000, 99],
        [1321548180000, 98],
        [1322412180000, 100],
        [1322311380000, 97],
        [1320777780000, 97],
        [1321047780000, 98],
        [1321814580000, 96],
        [1322516580000, 98],
        [1321306980000, 99],
        [1321695780000, 97],
        [1320961380000, 73],
        [1320950580000, 91],
        [1321879380000, 95],
        [1320874980000, 72],
        [1321641780000, 98],
        [1321893780000, 94],
        [1321706580000, 92],
        [1322430180000, 98],
        [1321436580000, 91],
        [1321263780000, 98],
        [1320943380000, 96],
        [1321090980000, 98],
        [1321504980000, 86],
        [1321072980000, 97],
        [1322473380000, 95],
        [1322559780000, 98],
        [1321188180000, 98],
        [1321220580000, 99],
        [1321101780000, 95],
        [1321274580000, 96],
        [1321555380000, 98],
        [1322498580000, 88],
        [1322386980000, 95],
        [1322257380000, 98],
        [1322440980000, 99],
        [1320799380000, 96],
        [1321288980000, 97],
        [1321533780000, 96],
        [1321566180000, 98],
        [1321965780000, 87],
        [1322343780000, 72],
        [1321015380000, 94],
        [1321911780000, 96],
        [1320972180000, 98],
        [1321634580000, 71],
        [1321029780000, 93],
        [1321782180000, 93],
        [1322541780000, 95],
        [1321868580000, 94],
        [1322214180000, 95],
        [1322332980000, 93],
        [1320856980000, 90],
        [1322224980000, 96],
        [1321764420000, 98],
        [1322397780000, 96],
        [1321418580000, 93],
        [1321522980000, 94],
        [1322455380000, 92],
        [1321404180000, 94],
        [1320813780000, 91],
        [1322354580000, 98],
        [1321296180000, 96],
        [1321058580000, 94],
        [1320928980000, 96],
        [1321677780000, 94],
        [1320918180000, 88],
        [1321609380000, 98],
        [1321663380000, 100],
        [1321954980000, 95],
        [1320986580000, 92],
        [1321116180000, 94],
        [1321004580000, 94],
        [1321836180000, 97],
        [1320900180000, 91],
        [1321490580000, 95],
        [1321036980000, 96],
        [1321159380000, 96],
        [1321591380000, 93]
    ];
    data.sort(function (a, b) {
        return a[0] - b[0];
    });{% endcomment %}

    $.get('http://{{ server_ip }}:{{ server_port }}/json/{{ metric }}/{{ name }}/', function(data) {
        data.sort(function (a, b) {
            return a[0] - b[0];
        });
        // Create a timer
        var start = + new Date();

        // Create the chart
        $('#container').highcharts('StockChart', {
            chart: {
                events: {
                    load: function(chart) {
                        this.setTitle(null, {
                            text: 'Built chart in '+ (new Date() - start) +'ms'
                        });
                    }
                },
                zoomType: 'x'
            },
            chart : {
                zoomType: 'x'
            },

            navigator : {
                adaptToUpdatedData: false,
                series : {
                    data : data
                }
            },


            {% comment %}navigator : {
                adaptToUpdatedData: false,
                series : {
                    data : data
                }
            },{% endcomment %}

            scrollbar: {
                liveRedraw: false
            },

            rangeSelector: {
                buttons: [ {
                    type: 'hour',
                    count: 1,
                    text: '1h'
                }, {
                    type: 'day',
                    count: 1,
                    text: '1d'
                }, {
                    type: 'month',
                    count: 1,
                    text: '1m'
                }, {
                    type: 'all',
                    text: 'All'
                }],
                selected: 3
            },

            title: {
                text: "Node: " + document.getElementById('node').name
            },

            xAxis : {
                events : {
                    afterSetExtremes : afterSetExtremes
                },
                minRange: 60 * 1000 // one min
            },

            yAxis: {
                title: {
                    text: document.getElementById('metric').name
                }
            },

            series: [{
                name: 'value',
                data: data,
                type: 'area',
                tooltip: {
                    yDecimals: 4
                },
                dataGrouping: {
                    enabled: false
                }


            }]
        });
    }).error(function(xhr, status, error) { alert("An AJAX error occured: " + status + "\nError: " + error + "\nError detail: " + xhr.responseTexts); });
});

/**
 * Load new data depending on the selected min and max
 */
function afterSetExtremes(e) {

    var url,
            currentExtremes = this.getExtremes(),
            range = e.max - e.min;
    var chart = $('#container').highcharts();
    chart.showLoading('Loading data from server...');
    // Create a timer
    var start = + new Date();

    $.get('http://{{ server_ip }}:{{ server_port }}/json/{{ metric }}/{{name }}/start_time='+ Math.round(e.min) +
            '&end_time='+ Math.round(e.max), function(data) {
        data.sort(function (a, b) {
            return a[0] - b[0];
        });

        chart.series[0].setData(data);
        chart.setTitle(null, {
            text: 'Built chart in '+ (new Date() - start) +'ms'
        });
        chart.hideLoading();
    });

}

</script>
</head>
<body>
<form>
    <input type="hidden" id="node" name={{ name }}>
    <input type="hidden" id="metric" name={{ metric }}>
    <input type="hidden" id="server_ip" name={{ server_ip }}>
    <input type="hidden" id="server_port" name={{ server_port }}>
</form>

<h1>Node: {{ name }},  Value: {{ metric }} </h1>
<script src="http://code.highcharts.com/stock/highstock.js"></script>
<script src="http://code.highcharts.com/stock/modules/exporting.js"></script>
<div id="container" style="height: 500px; min-width: 500px"></div>
</body>
</html>
